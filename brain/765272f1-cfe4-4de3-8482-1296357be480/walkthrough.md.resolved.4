# Timetable Redesign — Walkthrough

## Changes Made

### Backend ([timetable.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py))
- Added [get_academic_week_info()](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#430-502) helper with hardcoded NUS semester start dates (Sem 2 AY25/26 = 13 Jan 2026)
- New `GET /academic-week` endpoint returns current week label, semester, and academic year
- `GET /week` response now includes [academic_week](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#504-523) object alongside slots

### Frontend ([page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/timetable/page.tsx))
Full rewrite from CSS grid → **table-based layout** matching LMS Manager style:
- `rowSpan` for multi-hour blocks
- Desaturated HSL backgrounds with coloured left border accent
- Class type shortform badges (`LEC`, `TUT`, `LAB`, `REC`)
- Academic week header with semester/AY info
- Module legend panel at bottom

## Result

### Horizontal View (Default - Days on Y-axis)
![Horizontal Timetable View with full width mode](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_horizontal_view_1772008814656.png)

### Vertical View (Days on X-axis)
![Vertical Timetable View](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_vertical_view_1772008823605.png)

### Video Walkthrough
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_horizontal_1772008808315.webp"></video>

### EXDATE Filtering (Recess Week vs Teaching Week)
````carousel
![Teaching Week (Week 6) - Classes Populated](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/week_6_timetable_1772032811202.png)
<!-- slide -->
![Recess Week (Week 7) - Empty state due to EXDATEs](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/recess_week_empty_1772033945195.png)
````

## Phase 2 & 3: Direct URL Integration & Rich Module Metadata
Users can now paste a NUSMods share URL directly into the timetable to fetch slots immediately, mapping to the perfect exact weeks.
We also expanded the [Course](file:///Users/oli/Desktop/CraftCanvas/backend/models/course.py#37-64) database schema to import rich NUSMods module data context, natively displaying MCs, description, load, and examination scheduling inside the Course view widget.

### Direct URL Import Demo
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/verify_url_import_ui_1772041996140.webp"></video>

### Rich Module Data Overview
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/verify_rich_module_data_1772042291283.webp"></video>

## Phase 4: Accuracy & Week Offset Fix
Identified and corrected a critical 1-day offset in the semester start date (Jan 13 -> Jan 12) which previously caused Monday classes to be miscalculated and shifted week labeling.

### Final Verification Result (API Match)
The following layout has been verified to match the user's NUSMods screenshot perfectly:
- **Jan 12, 2026**: Corrected to Week 1 (Monday classes visible).
- **Feb 23 - Mar 1, 2026**: Corrected to Recess Week (Empty state).
- **GESS1025 (Odd Weeks)**: Verified visible in Week 7 (Mar 5), hidden in Week 6 (Feb 19).
- **MA1522 (Multi-slot)**: Verified appearing on both Tuesday and Friday 16:00 in teaching weeks.

## Verified
- ✅ Horizontal view is default (Days on Y, Times on X)
- ✅ Seamless view toggling via header icons
- ✅ Removed max-width restriction for a full-screen grid
- ✅ Correct spanning calculation for horizontal (`colSpan`) vs vertical (`rowSpan`)
- ✅ Classes excluded via `EXDATE` in ICS files (e.g. Recess Week, Public Holidays) are now correctly omitted from the timetable
- ✅ Week navigation bug fixed: frontend now securely queries specific dates in local timezone
- ✅ Academic week auto-detected correctly (e.g. Recess Week for Feb 23, 2026)
- ✅ Semester start dates corrected for AY2024/25 and AY2025/26
- ✅ Alternate-week class occurrences (e.g. GESS1025) follow NUSMods pattern
- ✅ Multi-day lessons for the same class (e.g. MA1522 LEC 2) correctly duplicated
- ✅ Grid renders with all imported modules (BT1101, CS2030, GEX1015, MA1522, GESS1025)
- ✅ Week navigation (prev/today/next) works correctly
- ✅ Module legend displays at bottom
- ✅ Today's column highlighted
- ✅ Light/dark mode compatible via CSS variables
