# Timetable Redesign — Walkthrough

## Changes Made

### Backend ([timetable.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py))
- Added [get_academic_week_info()](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#431-503) helper with hardcoded NUS semester start dates (Sem 2 AY25/26 = 13 Jan 2026)
- New `GET /academic-week` endpoint returns current week label, semester, and academic year
- `GET /week` response now includes [academic_week](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#505-524) object alongside slots

### Frontend ([page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/timetable/page.tsx))
Full rewrite from CSS grid → **table-based layout** matching LMS Manager style:
- `rowSpan` for multi-hour blocks
- Desaturated HSL backgrounds with coloured left border accent
- Class type shortform badges (`LEC`, `TUT`, `LAB`, `REC`)
- Academic week header with semester/AY info
- Module legend panel at bottom

## Result

### Horizontal View (Default - Days on Y-axis)
![Horizontal Timetable View with full width mode](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_horizontal_view_1772008814656.png)

### Vertical View (Days on X-axis)
![Vertical Timetable View](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_vertical_view_1772008823605.png)

### Video Walkthrough
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/timetable_horizontal_1772008808315.webp"></video>

### EXDATE Filtering (Recess Week vs Teaching Week)
````carousel
![Teaching Week (Week 6) - Classes Populated](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/week_6_timetable_1772032811202.png)
<!-- slide -->
![Recess Week (Week 7) - Empty state due to EXDATEs](/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/recess_week_empty_1772033945195.png)
````

## Phase 2 & 3: Direct URL Integration & Rich Module Metadata
Users can now paste a NUSMods share URL directly into the timetable to fetch slots immediately, mapping to the perfect exact weeks.
We also expanded the [Course](file:///Users/oli/Desktop/CraftCanvas/backend/models/course.py#37-64) database schema to import rich NUSMods module data context, natively displaying MCs, description, load, and examination scheduling inside the Course view widget.

### Direct URL Import Demo
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/verify_url_import_ui_1772041996140.webp"></video>

### Rich Module Data Overview
<video controls src="/Users/oli/.gemini/antigravity/brain/765272f1-cfe4-4de3-8482-1296357be480/verify_rich_module_data_1772042291283.webp"></video>

## Phase 5: ICS Import Verification
Verified the standard NUSMods ICS import flow by importing `nusmods_calendar (3).ics` directly via the backend API.

### Verification Result
- **Import Success**: Successfully imported 11 slots for 5 modules (BT1101, CS2030, GEX1015, MA1522, GESS1025).
- **Bug Fix**: Fixed an `UnboundLocalError` in the backend [import_timetable](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#117-255) function that occurred when matching courses with rich metadata.
- **Data Integrity**: Verified via API that all classes appear on their specific days (including multi-slot ones like MA1522) and follow complex week rules (like GESS1025 tutorial on odd weeks).
- **Recess Week**: Confirmed that the ICS-imported timetable correctly respects the fixed academic dates and shows an empty "Recess Week".

## Verified
- ✅ Horizontal view is default (Days on Y, Times on X)
- ✅ Seamless view toggling via header icons
- ✅ Removed max-width restriction for a full-screen grid
- ✅ Correct spanning calculation for horizontal (`colSpan`) vs vertical (`rowSpan`)
- ✅ Classes excluded via `EXDATE` in ICS files (e.g. Recess Week, Public Holidays) are now correctly omitted from the timetable
- ✅ Week navigation bug fixed: frontend now securely queries specific dates in local timezone
- ✅ Academic week auto-detected correctly (e.g. Recess Week for Feb 23, 2026)
- ✅ Semester start dates corrected for AY2024/25 and AY2025/26
- ✅ Alternate-week class occurrences (e.g. GESS1025) follow NUSMods pattern
- ✅ Multi-day lessons for the same class (e.g. MA1522 LEC 2) correctly duplicated
- ✅ **ICS Import Bug Fix**: Resolved internal server error during [.ics](file:///Users/oli/Desktop/CraftCanvas/ReferenceFiles/nusmods_calendar%20%283%29.ics) file upload
- ✅ Grid renders with all imported modules from user-provided ICS file
- ✅ Week navigation (prev/today/next) works correctly
- ✅ Module legend displays at bottom
- ✅ Today's column highlighted
- ✅ Light/dark mode compatible via CSS variables
