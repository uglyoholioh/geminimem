# Timetable Import Display Fix — Walkthrough

## Root Cause

Today (Feb 26, 2026) is **NUS Recess Week**. The [slot_occurs_on_date](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py#25-115) function correctly filters out all classes during recess. However, the frontend showed the same "No class schedules yet" empty state whether classes were imported or not — making the import appear broken.

## Changes Made

### Backend — [timetable.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/timetable.py)

Added `total_slots` to the `/week` response so the frontend can distinguish "no imports" from "no classes this week":

```diff
 return {
     ...
     "slots": week_slots,
+    "total_slots": len(all_slots),
 }
```

---

### Frontend — [page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/timetable/page.tsx)

1. **Differentiated empty states** — `total_slots === 0` shows the import prompt; `total_slots > 0 && slots === 0` shows a contextual banner with a ☕ Coffee icon (Recess Week fix).

2. **Auto-navigate after import** — Automatically jumps to semester week 1 if the current week is non-teaching.

3. **Dynamic Hour Range** — The table now calculates a custom hour range with `useMemo` based on your weekly classes. If you have classes from 10 AM to 4 PM, the 8 AM, 9 AM, 5 PM, etc., slots are hidden to save space.

4. **Improved Grid Math** — Classes ending with minutes (e.g., 10:30) are now correctly rounded up to occupy the full 11:00 slot in the hour-based grid, preventing visual cutoffs.

## Verification

| Check | Result |
|---|---|
| Backend tests ([test_timetable.py](file:///Users/oli/Desktop/CraftCanvas/backend/tests/test_routers/test_timetable.py)) | ✅ 2/2 passed |
| Frontend build (`next build`) | ✅ Clean build |
| Dynamic hour range | ✅ Verified (unions weekly slots) |
