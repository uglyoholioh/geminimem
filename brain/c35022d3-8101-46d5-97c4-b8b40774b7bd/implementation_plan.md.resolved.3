# CraftCanvas ‚Äî Master Implementation Plans

> Each plan below is **self-contained** and can be picked up independently. They are ordered by priority. Each includes the exact files to modify, what to change, and how to verify.

---

## Table of Contents

| # | Priority | Plan | Type |
|---|----------|------|------|
| 1 | üî¥ P0 | [Fix Assignments Page "Wall of Red"](#plan-1-fix-assignments-page-wall-of-red) | Backend + Frontend |
| 2 | üî¥ P0 | [Revive the Dashboard for Off-Days](#plan-2-revive-the-dashboard-for-off-days) | Frontend |
| 3 | üî¥ P0 | [Remove Client-Side API Key Exposure](#plan-3-remove-client-side-api-key-exposure) | Frontend config |
| 4 | üü° P1 | [Migrate Grades from localStorage to Backend](#plan-4-migrate-grades-from-localstorage-to-backend) | Backend + Frontend |
| 5 | üü° P1 | [Connect Focus Timer to Tasks](#plan-5-connect-focus-timer-to-tasks) | Frontend |
| 6 | üü° P1 | [Decompose God Components](#plan-6-decompose-god-components) | Frontend refactor |
| 7 | üü° P1 | [Update Design System Doc](#plan-7-update-design-system-doc) | Documentation |
| 8 | üü¢ P2 | [Reorganise Sidebar Navigation](#plan-8-reorganise-sidebar-navigation) | Frontend |
| 9 | üü¢ P2 | [Make Timetable Useful During Breaks](#plan-9-make-timetable-useful-during-breaks) | Frontend |
| 10 | üü¢ P2 | [Improve Tasks Page Defaults](#plan-10-improve-tasks-page-defaults) | Frontend |
| 11 | üü¢ P2 | [Global Search (‚åòK)](#plan-11-global-search-cmdk) | Backend + Frontend |
| 12 | üü° P1 | [iOS API Readiness](#plan-12-ios-api-readiness) | Backend |
| 13 | üü° P1 | [Push Notifications (APNs + Backend)](#plan-13-push-notifications-apns--backend) | Backend |
| 14 | üü¢ P2 | [iOS App Feature Ideas](#plan-14-ios-app-feature-ideas) | Design reference |

---

## Plan 1: Fix Assignments Page "Wall of Red"

### Problem
Every assignment shows as "overdue" in red because `user_status` defaults to `not_started` and Canvas submission status (`is_submitted`) is never used to auto-update it. Additionally, the default view shows ALL assignments (including submitted ones mixed with non-submittable items), and date-only titles like "16 Jan 2026" are meaningless.

### Root Cause
In [canvas_sync.py](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py#L186-L201), `is_submitted` is synced from Canvas (`has_submitted`), but `user_status` is never automatically updated based on it. The assignment model already has both fields ‚Äî they just aren't connected.

### Proposed Changes

---

#### Backend

##### [MODIFY] [canvas_sync.py](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py)

In the [sync_assignments](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py#139-279) function, after updating `existing.is_submitted` (around line 199), add logic to auto-promote `user_status`:

```python
# After line 199: existing.is_submitted = assign_data.get("has_submitted", False)
# Add auto-status promotion:
if existing.is_submitted and existing.user_status in ("not_started", "in_progress"):
    existing.user_status = "submitted"
    if assign_data.get("score"):
        existing.user_status = "graded"
        existing.canvas_score = assign_data.get("score")
```

Also do the same for newly created assignments (around line 216):

```python
# After line 216: is_submitted=assign_data.get("has_submitted", False),
# Set initial user_status based on submission:
user_status = "not_started"
if assign_data.get("has_submitted", False):
    user_status = "submitted"
if assign_data.get("score") is not None:
    user_status = "graded"
```

##### [MODIFY] [canvas_sync.py](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py)

Also fetch submission data from Canvas. The assignments API supports `include[]=submission` parameter. Update the `params` dict around line 152-155:

```python
params = {
    "per_page": 50,
    "order_by": "due_at",
    "include[]": "submission"  # Add this line
}
```

Then use the submission data to get more accurate status:

```python
submission = assign_data.get("submission", {})
has_submitted = submission.get("workflow_state") in ("submitted", "graded", "pending_review") if submission else assign_data.get("has_submitted", False)
score = submission.get("score") if submission else assign_data.get("score")
```

---

#### Frontend

##### [MODIFY] [assignments/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/assignments/page.tsx)

**Change 1: Default filter to "Needs Attention"**

The page currently loads ALL assignments. Change the default filter state so submitted/graded items are hidden by default. Find the initial state setup and add:

```typescript
// Default: hide submitted and graded
const [hideSubmitted, setHideSubmitted] = useState(true)
```

Apply this filter to the displayed list by default ‚Äî only show assignments where `user_status` is NOT `submitted` or `graded`.

**Change 2: Group assignments by week instead of flat list**

Instead of rendering assignments as a flat chronological list, group them by ISO week:

```typescript
function groupByWeek(assignments: Assignment[]): Record<string, Assignment[]> {
    const groups: Record<string, Assignment[]> = {}
    for (const a of assignments) {
        if (!a.due_at) { groups['No due date'] = [...(groups['No due date'] || []), a]; continue }
        const d = new Date(a.due_at)
        const weekStart = new Date(d)
        weekStart.setDate(d.getDate() - d.getDay() + 1) // Monday
        const label = `Week of ${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`
        groups[label] = [...(groups[label] || []), a]
    }
    return groups
}
```

**Change 3: Auto-collapse old overdue items**

Assignments that are > 14 days overdue should be collapsed into an "Older Overdue" section that's collapsed by default.

**Change 4: Add progress meter**

At the top of the page, show a simple progress bar: "X of Y assignments completed this semester".

### Verification

- **Backend test**: Add a test in [backend/tests/test_services/test_canvas_sync.py](file:///Users/oli/Desktop/CraftCanvas/backend/tests/test_services/test_canvas_sync.py) that mocks Canvas API response with `has_submitted: true` and `submission.workflow_state: "submitted"`, then asserts that the synced assignment has `user_status == "submitted"`.
- Run existing backend tests: `cd backend && python -m pytest tests/ -v`
- **Manual verification**: After sync, check `/assignments` page ‚Äî submitted items should be hidden by default, remaining items grouped by week.

---

## Plan 2: Revive the Dashboard for Off-Days

### Problem
The dashboard is designed around "today" and fails during weekends, breaks, and evenings with no classes. The "Today's Agenda" shows "Nothing scheduled today", the brief is blank, and stats badges show numbers that don't correspond to anything visible.

### Proposed Changes

#### [MODIFY] [page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx) (Dashboard)

**Change 1: Agenda ‚Äî show next 7 days when today is empty**

Currently the agenda only shows items where [isToday(t.due_date)](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx#528-535) is true (line 504-510). When `agendaItems.length === 0`, instead of showing the "Nothing scheduled" placeholder, fetch and display upcoming items for the next 7 days:

```typescript
// After computing agendaItems (line 537-556):
const upcomingItems: AgendaItem[] = [] // If today is empty, show next 7 days
if (agendaItems.length === 0) {
    const next7Days = new Date()
    next7Days.setDate(next7Days.getDate() + 7)

    // Filter tasks and assignments due in next 7 days
    const upcomingTasks = tasks.filter(t => {
        if (!t.due_date) return false
        const d = new Date(t.due_date)
        return d > today && d <= next7Days && t.status !== 'completed'
    })

    const upcomingAssignments = assignments.filter(a => {
        if (!a.due_at) return false
        const d = new Date(a.due_at)
        return d > today && d <= next7Days && a.user_status !== 'submitted' && a.user_status !== 'graded'
    })
    // ... map them into AgendaItem[] with date labels
}
```

Render these with date group headers like "Tomorrow", "Wednesday", "Thu 6 Mar".

**Change 2: Stat badges should be clickable and link to relevant sections**

The header stat badges (`15 due`, `10 unread`) at lines 582-586 are currently inert. Make them:
- `tasks` badge ‚Üí link to `/tasks`
- `classes` badge ‚Üí link to `/timetable`
- [due](file:///Users/oli/Desktop/CraftCanvas/frontend/app/assignments/page.tsx#111-115) badge ‚Üí scroll to a visible "Upcoming Deadlines" section on the dashboard (or link to `/assignments`)
- `unread` badge ‚Üí link to `/announcements`

Wrap each [StatBadge](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx#130-156) in a `<Link>` component.

**Change 3: Module Hub stats need labels**

In the Module Hub cards (around line 765-777), the stats show just numbers with icons. Add text labels:

Currently: icon + `24` + icon + `0` + icon + `17`

Change to: icon + `24` + `asgn` + icon + `0` + `tasks` + icon + `17` + [ann](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py#281-353)

Or use tooltips on hover. The key is that bare numbers are meaningless.

**Change 4: When no brief exists, show a mini auto-summary**

In [DailyBriefSummary.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/chat/DailyBriefSummary.tsx) (line 57-72), instead of showing "No brief generated yet", compute and show a simple auto-summary from the already-fetched data:

```
üìã You have 1 open task and 15 assignments due
üìÖ No classes today (Recess Week)
üîî 10 unread announcements
```

This doesn't require AI ‚Äî it just renders the stat data that's already available on the dashboard.

### Verification

- **Manual test**: Load the dashboard on a weekend or during recess week. Verify:
  1. Agenda shows upcoming items for the next 7 days instead of "Nothing scheduled"
  2. Stat badges are clickable
  3. Module Hub stats have labels
  4. Brief section shows a data summary instead of blank placeholder
- Run frontend tests: `cd frontend && npx vitest run`

---

## Plan 3: Remove Client-Side API Key Exposure

### Problem
[api.ts](file:///Users/oli/Desktop/CraftCanvas/frontend/lib/api.ts#L24) uses `process.env.NEXT_PUBLIC_API_KEY` ‚Äî the `NEXT_PUBLIC_` prefix means this is bundled into the client JavaScript bundle. This violates the security rule in CLAUDE.md: "Never expose API key client-side".

### Proposed Changes

#### [MODIFY] [next.config.js](file:///Users/oli/Desktop/CraftCanvas/frontend/next.config.js)

Add rewrites to proxy API calls through Next.js, so the backend API key is only used server-side:

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
    reactStrictMode: true,
    async rewrites() {
        return [
            {
                source: '/api/v1/:path*',
                destination: `${process.env.BACKEND_URL || 'http://localhost:8000'}/api/v1/:path*`,
            },
        ]
    },
}
module.exports = nextConfig
```

#### [MODIFY] [api.ts](file:///Users/oli/Desktop/CraftCanvas/frontend/lib/api.ts)

Remove the `X-API-Key` header from client-side requests. Since the rewrite proxies through the same origin, we can either:

**Option A (simpler):** Remove the API key header entirely and configure the backend to trust requests from the local Next.js server (this is appropriate for a self-hosted single-user app).

**Option B (more secure):** Use Next.js API routes as a proper BFF (Backend-for-Frontend) layer. Create `/app/api/v1/[...path]/route.ts` that adds the API key server-side.

**Recommended: Option A** since this is a self-hosted single-user app. Remove the `X-API-Key` header from [api.ts](file:///Users/oli/Desktop/CraftCanvas/frontend/lib/api.ts):

```typescript
// Remove line 24:
// "X-API-Key": process.env.NEXT_PUBLIC_API_KEY || "dev-secret-key-change-in-production",
// And from the stream function (line 59) and upload function (line 103)
```

Then in the backend middleware, add an exception for requests coming from localhost / the Next.js rewrite proxy, or configure the backend to use session cookies (which the auth system already supports via `AuthProvider`).

#### [MODIFY] [.env.local](file:///Users/oli/Desktop/CraftCanvas/frontend/.env.local)

Remove `NEXT_PUBLIC_API_KEY`. Add:

```
BACKEND_URL=http://localhost:8000
```

### Verification

- Start the app (`npm run dev`), open browser DevTools ‚Üí Network tab
- Verify requests to `/api/v1/*` do NOT include `X-API-Key` in headers
- Verify the app still works (login, fetch tasks, chat, etc.)
- View page source / JS bundle to confirm no API key is present

---

## Plan 4: Migrate Grades from localStorage to Backend

### Problem
[grades/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx) stores all grade data in `localStorage` using key `academic-os-grades`. This means grades are lost on browser data clear, don't sync across devices, and can't be used by the AI for context. The backend already has the proper models: [GradeComponent](file:///Users/oli/Desktop/CraftCanvas/backend/models/grade.py#L8-L22) and [GradeEntry](file:///Users/oli/Desktop/CraftCanvas/backend/models/grade.py#L25-L38).

### Proposed Changes

#### Backend

##### [NEW] [routers/grades.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/grades.py)

Create a new grades router with the following endpoints:

```python
# GET /grades
# Returns all grade components and entries grouped by course
# Response: { "modules": [{ "course_id": 1, "course_code": "CS2030", "course_name": "...", "components": [...] }] }

# POST /grades/components
# Create a new grade component
# Body: { "course_id": int, "name": str, "weight": float, "max_score": float }

# PATCH /grades/components/{id}
# Update a grade component

# DELETE /grades/components/{id}
# Delete a grade component and its entries

# PATCH /grades/entries/{id}
# Update score/notes for a component
```

Use SQLModel, follow the pattern in [assignments.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/assignments.py) for auth and session handling.

##### [MODIFY] [main.py](file:///Users/oli/Desktop/CraftCanvas/backend/main.py)

Register the new router: `app.include_router(grades_router, prefix="/api/v1/grades")`

##### [MODIFY] [database.py](file:///Users/oli/Desktop/CraftCanvas/backend/database.py)

Ensure [GradeComponent](file:///Users/oli/Desktop/CraftCanvas/backend/models/grade.py#8-23) and [GradeEntry](file:///Users/oli/Desktop/CraftCanvas/backend/models/grade.py#25-39) models are imported so SQLModel creates the tables:

```python
from models.grade import GradeComponent, GradeEntry
```

---

#### Frontend

##### [MODIFY] [grades/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx)

**Full rewrite** ‚Äî replace all `localStorage` calls with API calls:

1. Replace [loadGrades()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#23-32) (line 23-31) with `useEffect` that fetches from `api.get('/grades')`
2. Replace [saveGrades()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#33-36) (line 33-35) ‚Äî remove entirely, use API calls for each mutation
3. Replace [addModule()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#77-90) (line 77-89) with `api.post('/grades/components', { course_id, name, weight, max_score })`
4. Replace [updateComponent()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#103-108) (line 103-107) with `api.put('/grades/components/${id}', data)`
5. Replace [removeComponent()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#109-114) (line 109-113) with `api.delete('/grades/components/${id}')`
6. Replace [removeModule()](file:///Users/oli/Desktop/CraftCanvas/frontend/app/grades/page.tsx#115-121) (line 115-120) with delete all components for that course

Also enhance the UI:
- Add a course selector dropdown that pulls from `api.get('/courses')` instead of manual text input for module code/name
- Show calculated grades inline with NUS grading scale

### Verification

- **Backend test**: Add `backend/tests/test_routers/test_grades.py` following the pattern in [test_tasks.py](file:///Users/oli/Desktop/CraftCanvas/backend/tests/test_routers/test_tasks.py). Test CRUD operations for components and entries.
- Run: `cd backend && python -m pytest tests/test_routers/test_grades.py -v`
- **Manual test**: Open `/grades`, add a module, add components, enter scores, refresh the page. Data should persist. Clear localStorage ‚Äî data should still persist.

---

## Plan 5: Connect Focus Timer to Tasks

### Problem
The focus timer at `/focus` is disconnected from the rest of the app. Users can't start a focus session from a task card, and there's no focus time stats on the dashboard.

The timer infrastructure already exists: [FocusTimerProvider.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/FocusTimerProvider.tsx) tracks `accumulatedSeconds` and pushes `actual_minutes` to the task backend every 60 seconds (line 70-81). The floating timer ([FloatingTimer.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/FloatingTimer.tsx)) already shows on all pages.

### Proposed Changes

#### [MODIFY] [tasks/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx)

**Add a "Focus" button to each TaskRow component** (line 460-557):

Inside [TaskRow](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx#460-558), add a small timer icon button that:
1. Calls [useFocusTimer()](file:///Users/oli/Desktop/CraftCanvas/frontend/components/FocusTimerProvider.tsx#34-39) hook to get `setSelectedTask` and `toggleTimer`
2. On click: sets the selected task and starts the timer
3. If a timer is already running for this task, show the current time instead

```tsx
import { useFocusTimer } from '@/components/FocusTimerProvider'

// Inside TaskRow:
const { selectedTaskId, setSelectedTask, toggleTimer, isRunning, formatTime, timeLeft } = useFocusTimer()
const isThisTaskFocused = selectedTaskId === task.id

// Render a focus button:
<button onClick={() => {
    setSelectedTask(task.id, task.title)
    if (!isRunning) toggleTimer()
}}>
    {isThisTaskFocused && isRunning
        ? <span className="text-[10px] font-mono text-accent">{formatTime(timeLeft)}</span>
        : <Play className="h-3 w-3" />}
</button>
```

#### [MODIFY] [assignments/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/assignments/page.tsx)

Add the same focus button to assignment rows. When clicked, it auto-creates a task for that assignment (if one doesn't exist) and starts the timer.

#### [MODIFY] [page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx) (Dashboard)

**Add daily focus stats to the header:**

Add a new stat badge showing today's total focus time. Fetch from tasks' `actual_minutes`:

```typescript
const todayFocusMinutes = tasks.reduce((sum, t) => sum + (t.actual_minutes || 0), 0) // simplified
// Or add a dedicated backend endpoint: GET /tasks/focus-stats?date=today

// In the header:
<StatBadge icon={<Timer className="h-3 w-3" />} value={todayFocusMinutes} label="min focused" />
```

#### [MODIFY] [FloatingTimer.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/FloatingTimer.tsx)

Make the floating timer more prominent:
- Show the task name alongside the timer
- Add a "next task" suggestion when timer completes
- Make it slightly larger (current implementation is already decent)

### Verification

- **Manual test**:
  1. Go to `/tasks`, find a task, click the new Focus button
  2. Verify the floating timer starts counting down
  3. Verify the timer shows on the Focus button itself
  4. Go to `/focus` page ‚Äî verify the same task is selected
  5. Complete a pomodoro ‚Äî verify `actual_minutes` updates on task refresh
- Run: `cd frontend && npx vitest run`

---

## Plan 6: Decompose God Components

### Problem
Several page files are excessively large:
- [page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx) (Dashboard): 815 lines, 17 useState hooks
- [tasks/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx): 1,687 lines
- [timetable/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/timetable/page.tsx): 1,032 lines

### Proposed Changes

> [!IMPORTANT]
> This is a refactor-only plan. No behaviour changes. All tests should continue to pass.

#### Dashboard ([page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx) ‚Üí 5 files)

##### [NEW] `frontend/components/dashboard/DashboardHeader.tsx`
Extract lines 572-587 (header with greeting, date, stat badges). Props: `{ user, openTaskCount, todaySlots, dueSoonCount, unreadCount }`.

##### [NEW] `frontend/components/dashboard/AgendaTimeline.tsx`
Extract lines 627-665 (Today's Agenda section). Props: `{ agendaItems }`.

##### [NEW] `frontend/components/dashboard/ModuleHub.tsx`
Extract lines 668-787 (Module Hub section including visibility toggle). Props: `{ courses, allCourses, tasks, assignments, isManageModules, ... handlers }`.

##### [NEW] `frontend/components/dashboard/QuickStats.tsx`
Extract the [StatBadge](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx#130-156) component and related logic.

##### [MODIFY] [frontend/app/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/page.tsx)
Reduce to ~200 lines: data fetching, state management, and composing the extracted components.

##### [NEW] `frontend/lib/taskSort.ts`
Extract the duplicated sort logic (lines 203-221, repeated at 313-331) into a shared utility:

```typescript
export function sortTasksByCriticality(tasks: Task[]): Task[] {
    return [...tasks].sort((a, b) => {
        // ... existing sort logic
    })
}
```

---

#### Tasks ([tasks/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx) ‚Üí 5+ files)

The file already has some internal components ([InlineTaskCreator](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx#154-457), [TaskRow](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx#460-558), [TimelineView](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx#561-624)). Extract them:

##### [NEW] `frontend/components/tasks/InlineTaskCreator.tsx` (lines 154-456)
##### [NEW] `frontend/components/tasks/TaskRow.tsx` (lines 460-557)
##### [NEW] `frontend/components/tasks/TimelineView.tsx` (lines 561-623)
##### [NEW] `frontend/components/tasks/TaskDetailPanel.tsx` (extract the detail panel, lines 627+)
##### [MODIFY] [frontend/app/tasks/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx) ‚Üí reduce to ~400 lines

---

#### Settings ([settings/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/settings/page.tsx))

##### [NEW] `frontend/components/settings/ProfileTab.tsx`
##### [NEW] `frontend/components/settings/CanvasTab.tsx`
##### [NEW] `frontend/components/settings/AppearanceTab.tsx`
##### [NEW] `frontend/components/settings/AIContextTab.tsx`
##### [MODIFY] [frontend/app/settings/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/settings/page.tsx) ‚Üí tab router + shared state only

### Verification

- Run `cd frontend && npx vitest run` ‚Äî all existing tests pass
- Run `cd frontend && npm run build` ‚Äî no TypeScript errors
- **Manual test**: Navigate through Dashboard, Tasks, Settings ‚Äî verify all features work identically

---

## Plan 7: Update Design System Doc

### Problem
[DESIGN_SYSTEM.md](file:///Users/oli/Desktop/CraftCanvas/docs/DESIGN_SYSTEM.md) describes a dark terminal aesthetic with DM Sans, amber accent, no shadows, no rounded corners. The actual app uses Inter, earthy green accent (`#7C8C6E`), `rounded-xl` everywhere, multiple shadows, and multiple colour schemes.

### Proposed Changes

#### [MODIFY] [DESIGN_SYSTEM.md](file:///Users/oli/Desktop/CraftCanvas/docs/DESIGN_SYSTEM.md)

**Full rewrite** to match the actual implementation. Key updates:

1. **Aesthetic direction**: Change from "Dense Terminal" to "Warm Academic" ‚Äî earthy, muted tones inspired by stationery and natural materials
2. **Colour palette**: Document the actual CSS variables from [globals.css](file:///Users/oli/Desktop/CraftCanvas/frontend/app/globals.css#L44-L70) including all 4 colour schemes (Default, Midnight, Forest, Sunset) with their light and dark variants
3. **Typography**: Update to show Inter (not DM Sans) as the body font, Instrument Serif for headings, DM Mono for labels
4. **Borders and shadows**: Acknowledge `rounded-xl` to `rounded-3xl` usage and `shadow-sm` usage
5. **Component patterns**: Update to reflect actual component patterns (rounded cards, accent-subtle backgrounds, etc.)
6. **Module colours**: Document the 8 earthy module colours (sage, clay, stone, rose, olive, mauve, eucalyptus, sienna) instead of the old CS/ST/MA/EE palette

### Verification

- Review the updated doc against the live app and [globals.css](file:///Users/oli/Desktop/CraftCanvas/frontend/app/globals.css) to ensure accuracy
- No code changes ‚Äî doc only

---

## Plan 8: Reorganise Sidebar Navigation

### Problem
10 sidebar icons + theme toggle + settings + user avatar = 13 interactive elements in a narrow 56px sidebar. Features like "Activity Finder" (meetings), "History", and "Grades" take the same visual priority as core features like Tasks and Timetable.

### Proposed Changes

#### [MODIFY] [Sidebar.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/layout/Sidebar.tsx)

**Change 1: Group navigation into tiers with a separator**

```typescript
const PRIMARY_NAV = [
    { href: '/', icon: LayoutDashboard, label: 'Dashboard' },
    { href: '/tasks', icon: CheckSquare, label: 'Tasks' },
    { href: '/assignments', icon: FileText, label: 'Assignments' },
    { href: '/timetable', icon: Calendar, label: 'Timetable' },
]

const SECONDARY_NAV = [
    { href: '/courses', icon: BookOpen, label: 'Courses' },
    { href: '/notes', icon: StickyNote, label: 'Notes' },
    { href: '/focus', icon: Timer, label: 'Focus' },
]

const UTILITY_NAV = [
    { href: '/grades', icon: BarChart3, label: 'Grades' },
    { href: '/history', icon: Clock, label: 'History' },
    { href: '/meetings', icon: Users, label: 'Activity Finder' },
]
```

Render with visual dividers between groups. The utility group should be collapsed by default behind a `...` more button that expands on click.

**Change 2: Add unread count badges**

Show a small red dot or count on the Assignments icon when there are overdue items, and on Announcements when there are unread items. The data is already available from the dashboard API calls.

### Verification

- **Manual test**: Verify all 10 nav items are still accessible. Primary items visible, utility items behind "more" button. Check tooltips work.
- Run: `cd frontend && npm run build`

---

## Plan 9: Make Timetable Useful During Breaks

### Problem
During recess/vacation weeks, the timetable page shows "Enjoy your break!" and nothing else. ~30% of the semester, this page is a blank.

### Proposed Changes

#### [MODIFY] [timetable/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/timetable/page.tsx)

**When `academic_week.label` is "Recess Week" or similar non-teaching period, show a "This Week" overview instead of the empty state.**

After the existing empty state check, add:

```tsx
// When it's a break week, show upcoming deadlines and tasks instead
{isBreakWeek && (
    <div className="p-6">
        <h3 className="font-serif text-lg mb-4">This Week's Deadlines</h3>
        {weekTasks.map(task => (
            // Render task/assignment cards grouped by day
        ))}
        <h3 className="font-serif text-lg mt-6 mb-4">Upcoming After Break</h3>
        {/* Show first week back of classes */}
    </div>
)}
```

The page already fetches `weekTasks` ‚Äî we just need to render them when the timetable grid is empty.

### Verification

- **Manual test**: Navigate to a recess/break week in the timetable. Verify deadlines and tasks for that week are shown instead of a blank page.
- Run: `cd frontend && npm run build`

---

## Plan 10: Improve Tasks Page Defaults

### Problem
With few tasks, the Kanban board shows 3 giant empty dashed columns. The page defaults to Kanban view regardless of task count.

### Proposed Changes

#### [MODIFY] [tasks/page.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/app/tasks/page.tsx)

**Change 1: Default to List view when task count < 5**

In the initial state or after data loads, auto-select the view mode:

```typescript
// After tasks load:
useEffect(() => {
    if (tasks.length < 5 && vizMode === 'kanban') {
        setVizMode('list')
    }
}, [tasks.length])
```

**Change 2: Add quick task templates**

Add a "Templates" dropdown next to "Add a new task..." that pre-fills common task structures:

```typescript
const TEMPLATES = [
    { label: 'Assignment Work', preset: { priority: 'high', tags: '["assignment"]', estimated_minutes: 120 } },
    { label: 'Exam Prep', preset: { priority: 'urgent', tags: '["exam"]', estimated_minutes: 180 } },
    { label: 'Reading', preset: { priority: 'medium', tags: '["reading"]', estimated_minutes: 60 } },
    { label: 'Project Work', preset: { priority: 'high', tags: '["project"]', estimated_minutes: 90 } },
]
```

### Verification

- **Manual test**: With < 5 tasks, verify default view is List. Add 5+ tasks, refresh ‚Äî verify it respects user's last choice. Verify templates create tasks with correct pre-filled fields.
- Run: `cd frontend && npx vitest run`

---

## Plan 11: Global Search (‚åòK)

### Problem
With 10+ pages of content, there's no way to quickly find things. Users need a ‚åòK palette to search across tasks, assignments, courses, notes, and announcements.

### Proposed Changes

#### Backend

##### [NEW] [routers/search.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/search.py)

Create a unified search endpoint:

```python
@router.get("/")
async def search(
    q: str = Query(..., min_length=1),
    current_user: User = Depends(get_current_user),
    session: Session = Depends(get_session),
    limit: int = Query(default=10, le=50)
) -> dict:
    """Search across tasks, assignments, courses, notes, and announcements."""
    results = []

    # Search tasks
    tasks = session.exec(
        select(Task).where(Task.user_id == current_user.id, Task.title.ilike(f"%{q}%"))
    ).all()
    results.extend([{"type": "task", "id": t.id, "title": t.title, "url": f"/tasks?selected={t.id}"} for t in tasks[:5]])

    # Search assignments
    assignments = session.exec(
        select(Assignment).where(Assignment.user_id == current_user.id, Assignment.title.ilike(f"%{q}%"))
    ).all()
    results.extend([{"type": "assignment", "id": a.id, "title": a.title, "url": f"/assignments?selected={a.id}"} for a in assignments[:5]])

    # Search courses
    courses = session.exec(
        select(Course).where(Course.user_id == current_user.id,
            (Course.code.ilike(f"%{q}%")) | (Course.name.ilike(f"%{q}%")))
    ).all()
    results.extend([{"type": "course", "id": c.id, "title": f"{c.code} ‚Äî {c.name}", "url": f"/courses/{c.id}"} for c in courses[:3]])

    # Search notes
    from models.note import Note
    notes = session.exec(
        select(Note).where(Note.user_id == current_user.id,
            (Note.title.ilike(f"%{q}%")) | (Note.content.ilike(f"%{q}%")))
    ).all()
    results.extend([{"type": "note", "id": n.id, "title": n.title, "url": f"/notes?id={n.id}"} for n in notes[:3]])

    return {"results": results[:limit]}
```

##### [MODIFY] [main.py](file:///Users/oli/Desktop/CraftCanvas/backend/main.py)

Register: `app.include_router(search_router, prefix="/api/v1/search", tags=["search"], dependencies=auth_dep)`

---

#### Frontend

##### [NEW] `frontend/components/CommandPalette.tsx`

Create a modal overlay triggered by `‚åòK` (or `Ctrl+K` on Windows):

```tsx
'use client'

import { useState, useEffect, useRef, useCallback } from 'react'
import { useRouter } from 'next/navigation'
import { api } from '@/lib/api'
import { Search, FileText, CheckSquare, BookOpen, StickyNote, X } from 'lucide-react'

export function CommandPalette() {
    const [open, setOpen] = useState(false)
    const [query, setQuery] = useState('')
    const [results, setResults] = useState([])
    const [selectedIndex, setSelectedIndex] = useState(0)
    const router = useRouter()
    const inputRef = useRef<HTMLInputElement>(null)

    // Listen for Cmd+K
    useEffect(() => {
        const handler = (e: KeyboardEvent) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault()
                setOpen(prev => !prev)
            }
            if (e.key === 'Escape') setOpen(false)
        }
        document.addEventListener('keydown', handler)
        return () => document.removeEventListener('keydown', handler)
    }, [])

    // Debounced search
    useEffect(() => {
        if (!query.trim()) { setResults([]); return }
        const timer = setTimeout(async () => {
            const data = await api.get('/search', { q: query })
            setResults(data.results || [])
        }, 200)
        return () => clearTimeout(timer)
    }, [query])

    // Navigate on select
    const handleSelect = (url: string) => {
        router.push(url)
        setOpen(false)
        setQuery('')
    }

    // ... render modal overlay with search input, results list
    // Support keyboard navigation (ArrowUp, ArrowDown, Enter)
    // Show type icons per result (task/assignment/course/note)
}
```

Also add static navigation items: "Go to Tasks", "Go to Timetable", "Go to Settings", etc. ‚Äî these should show when the search is empty.

##### [MODIFY] [ClientLayout.tsx](file:///Users/oli/Desktop/CraftCanvas/frontend/components/ClientLayout.tsx)

Add the `CommandPalette` component alongside the `FloatingTimer`:

```tsx
import { CommandPalette } from '@/components/CommandPalette'

// In the render:
{!isLoginPage && <CommandPalette />}
```

### Verification

- **Backend test**: Add `backend/tests/test_routers/test_search.py` ‚Äî test search with query that matches task titles, course codes, etc.
- Run: `cd backend && python -m pytest tests/test_routers/test_search.py -v`
- **Manual test**: Press ‚åòK on any page. Type a module code ‚Äî verify results appear. Click a result ‚Äî verify navigation works. Use arrow keys + Enter for keyboard navigation.

---

## Plan 12: iOS API Readiness

### Problem
The current backend API is designed for the Next.js web frontend (session cookies, web-only assumptions). An iOS app needs:
1. **Token-based auth** (not cookies) ‚Äî the iOS app can't rely on browser cookie jars
2. **Consistent response envelopes** ‚Äî iOS needs predictable JSON shapes
3. **Pagination** ‚Äî mobile devices can't load all 100+ assignments at once
4. **Device registration** ‚Äî for push notifications (Plan 13)

### Existing Foundation
- Auth router at `/api/v1/auth` already handles login/register
- Session cookies exist via `AuthProvider`, but `X-API-Key` header auth is also supported
- All data endpoints return JSON, which is good

### Proposed Changes

#### Backend

##### [MODIFY] [routers/auth.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/auth.py)

**Add JWT token auth flow for mobile clients:**

```python
# POST /api/v1/auth/token
# Body: { "email": str, "password": str }
# Returns: { "access_token": str, "refresh_token": str, "expires_in": 3600 }
#
# POST /api/v1/auth/token/refresh
# Body: { "refresh_token": str }
# Returns: { "access_token": str, "expires_in": 3600 }
```

Use PyJWT for token generation. Access tokens expire in 1 hour, refresh tokens in 30 days. Store refresh tokens in a new `refresh_tokens` table.

The access token should carry: `{ "user_id": int, "iat": int, "exp": int }`.

##### [MODIFY] [dependencies.py](file:///Users/oli/Desktop/CraftCanvas/backend/dependencies.py)

Update `get_current_user` to accept BOTH session cookies (web) AND Bearer tokens (iOS):

```python
async def get_current_user(request: Request, session: Session = Depends(get_session)) -> User:
    # Try 1: Session cookie (web)
    # Try 2: Bearer token (iOS)
    auth_header = request.headers.get("Authorization", "")
    if auth_header.startswith("Bearer "):
        token = auth_header[7:]
        payload = jwt.decode(token, settings.jwt_secret, algorithms=["HS256"])
        user = session.get(User, payload["user_id"])
        if user: return user
    # Try 3: X-API-Key (legacy/dev)
    # ... existing logic
```

##### [NEW] [models/device_token.py](file:///Users/oli/Desktop/CraftCanvas/backend/models/device_token.py)

```python
class DeviceToken(SQLModel, table=True):
    """APNs device tokens for push notifications."""
    __tablename__ = "device_tokens"

    id: Optional[int] = Field(default=None, primary_key=True)
    user_id: int = Field(foreign_key="users.id")
    token: str = Field(index=True, unique=True)  # APNs device token
    platform: str = Field(default="ios")  # ios | web
    created_at: datetime = Field(default_factory=datetime.utcnow)
    last_used_at: Optional[datetime] = None
```

##### [NEW] [routers/devices.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/devices.py)

```python
# POST /api/v1/devices/register
# Body: { "token": str, "platform": "ios" }
# Registers an APNs device token for push notifications

# DELETE /api/v1/devices/{token}
# Unregisters a device token (on logout or uninstall)
```

##### [MODIFY] Pagination for list endpoints

Add cursor-based pagination to heavy endpoints. Update the existing list endpoints:

- `GET /api/v1/assignments?page=1&per_page=20` (currently returns ALL assignments)
- `GET /api/v1/tasks?page=1&per_page=20` (currently returns ALL tasks)
- `GET /api/v1/announcements?page=1&per_page=20`

Response envelope:

```json
{
    "items": [...],
    "total": 87,
    "page": 1,
    "per_page": 20,
    "has_more": true
}
```

> [!IMPORTANT]
> Keep backward compatibility ‚Äî if `page` param is absent, return all items (web frontend still needs this). Only paginate when `page` is explicitly provided.

##### [NEW] [config.py](file:///Users/oli/Desktop/CraftCanvas/backend/config.py) additions

Add new settings:

```python
jwt_secret: str = "change-this-in-production"
jwt_access_token_expire_minutes: int = 60
jwt_refresh_token_expire_days: int = 30
apns_key_id: Optional[str] = None
apns_team_id: Optional[str] = None
apns_key_path: Optional[str] = None  # Path to .p8 file
apns_bundle_id: Optional[str] = None
```

### Verification

- **Backend test**: Add `test_routers/test_auth_token.py` ‚Äî test token generation, refresh, and expiry
- **Manual test**: Use `curl` to get a token, then access a protected endpoint with `Authorization: Bearer <token>`
- Run: `cd backend && python -m pytest tests/ -v`

---

## Plan 13: Push Notifications (APNs + Backend)

### Problem
Currently notifications are only via Telegram bot, which requires the user to have Telegram set up. With an iOS app, Apple Push Notifications (APNs) provides a much better notification experience ‚Äî native banners, sounds, badges, and Lock Screen integration.

### What to Notify About (Deadline Intelligence)

Instead of just "send reminder at X time", the notification system should be **smart**:

| Trigger | Example | Timing |
|---------|---------|--------|
| Assignment due soon | "BT1101 Quiz 2 is due in 24 hours" | 24h and 2h before due |
| Class starting | "CS2030 Lecture starts in 15 minutes @ COM1-0212" | 15min before |
| Canvas sync: new assignment | "New: BT1101 Datacamp Assignment on dplyr" | On sync |
| Canvas sync: new announcement | "üì¢ CS2030: Lab 4 Updated Instructions" | On sync |
| Daily brief ready | "Your morning brief is ready ‚òÄÔ∏è" | On generation (6am) |
| Focus streak | "You've maintained a 5-day focus streak! üî•" | After 5th consecutive day |
| Overdue warning | "You have 3 assignments due tonight" | Morning of due date |
| Grade posted | "BT1101: Quiz 1 graded ‚Äî 85/100" | On Canvas sync detection |

### Proposed Changes

#### Backend

##### [NEW] [services/push_service.py](file:///Users/oli/Desktop/CraftCanvas/backend/services/push_service.py)

APNs push notification service:

```python
import httpx
import jwt
import time
from config import settings

class PushService:
    """Send push notifications via Apple Push Notification service (APNs)."""

    def __init__(self):
        self._token = None
        self._token_expiry = 0

    def _get_apns_token(self) -> str:
        """Generate a provider authentication token (JWT for APNs)."""
        if self._token and time.time() < self._token_expiry:
            return self._token

        with open(settings.apns_key_path, 'r') as f:
            key = f.read()

        payload = {
            "iss": settings.apns_team_id,
            "iat": int(time.time()),
        }
        self._token = jwt.encode(payload, key, algorithm="ES256", headers={
            "kid": settings.apns_key_id,
        })
        self._token_expiry = time.time() + 3500  # Refresh before 1h expiry
        return self._token

    async def send(self, device_token: str, title: str, body: str,
                   category: str = "default", data: dict = None):
        """Send a single push notification."""
        url = f"https://api.push.apple.com/3/device/{device_token}"
        headers = {
            "authorization": f"bearer {self._get_apns_token()}",
            "apns-topic": settings.apns_bundle_id,
            "apns-push-type": "alert",
        }
        payload = {
            "aps": {
                "alert": {"title": title, "body": body},
                "sound": "default",
                "category": category,
            }
        }
        if data:
            payload["data"] = data

        async with httpx.AsyncClient(http2=True) as client:
            await client.post(url, json=payload, headers=headers)

    async def send_to_user(self, session, user_id: int, title: str, body: str, **kwargs):
        """Send to all registered devices for a user."""
        from models.device_token import DeviceToken
        tokens = session.exec(
            select(DeviceToken).where(DeviceToken.user_id == user_id)
        ).all()
        for dt in tokens:
            await self.send(dt.token, title, body, **kwargs)

push_service = PushService()
```

##### [NEW] [jobs/notification_jobs.py](file:///Users/oli/Desktop/CraftCanvas/backend/jobs/notification_jobs.py)

Scheduled notification jobs that run alongside the existing APScheduler:

```python
async def deadline_reminder_job():
    """Check for upcoming deadlines and send push notifications.
    Runs every hour."""
    # 1. Find assignments due in next 24h that haven't been notified
    # 2. Find assignments due in next 2h that haven't been notified
    # 3. Send push to each user via push_service.send_to_user()
    # 4. Mark as notified (store in settings or a notifications_sent table)

async def class_reminder_job():
    """Send 15-minute reminder before classes.
    Runs every 5 minutes."""
    # 1. Check timetable slots starting in 10-20 minutes
    # 2. Send push with venue info

async def new_content_notifier(user_id: int, content_type: str, title: str):
    """Called inline during Canvas sync when new content is found.
    Not a scheduled job ‚Äî called from canvas_sync.py."""
    # Send immediate push for new assignments / announcements
```

##### [MODIFY] [jobs/scheduler.py](file:///Users/oli/Desktop/CraftCanvas/backend/jobs/scheduler.py)

Register the new notification jobs. In [start_scheduler()](file:///Users/oli/Desktop/CraftCanvas/backend/jobs/scheduler.py#75-105):

```python
from jobs.notification_jobs import deadline_reminder_job, class_reminder_job

# Deadline reminders ‚Äî every hour
scheduler.add_job(
    deadline_reminder_job,
    IntervalTrigger(hours=1),
    id="deadline_reminders",
    name="Deadline Reminder Notifications",
    replace_existing=True,
)

# Class reminders ‚Äî every 5 minutes
scheduler.add_job(
    class_reminder_job,
    IntervalTrigger(minutes=5),
    id="class_reminders",
    name="Class Reminder Notifications",
    replace_existing=True,
)
```

##### [MODIFY] [services/canvas_sync.py](file:///Users/oli/Desktop/CraftCanvas/backend/services/canvas_sync.py)

When a **new** assignment or announcement is created during sync (the `else` branch around lines 203-220 and 312-328), also fire a push notification:

```python
# After creating new assignment:
try:
    from jobs.notification_jobs import new_content_notifier
    await new_content_notifier(
        user_id, "assignment",
        f"New: [{course_code}] {assignment.title}"
    )
except Exception:
    pass  # Don't fail sync for notification errors
```

##### [NEW] [routers/notifications.py](file:///Users/oli/Desktop/CraftCanvas/backend/routers/notifications.py)

User-facing notification preferences:

```python
# GET /api/v1/notifications/settings
# Returns: { "deadline_24h": true, "deadline_2h": true, "class_15min": true,
#            "new_assignments": true, "new_announcements": true, "daily_brief": true }

# PUT /api/v1/notifications/settings
# Update preferences
```

### Verification

- **Backend test**: Mock APNs endpoint, register a device, trigger a deadline reminder job, assert push was sent
- **Manual test**: Register an iOS simulator device token, trigger a Canvas sync with a new assignment, verify push arrives
- Run: `cd backend && python -m pytest tests/ -v`

---

## Plan 14: iOS App Feature Ideas

> [!NOTE]
> This is a **design reference** for when you build the iOS app, not an implementation plan for the backend. These are features that would leverage native iOS capabilities and should be kept in mind while building Plans 12-13.

### iOS Home Screen Widgets (WidgetKit)

| Widget | Size | Content |
|--------|------|---------|
| **Next Class** | Small | Module code, time, venue, countdown |
| **Daily Agenda** | Medium | Today's classes + due items (scrollable) |
| **Focus Stats** | Small | Today's total focus time, streak count |
| **Deadline Countdown** | Small | Next upcoming deadline with days/hours remaining |

These widgets poll the backend API on a schedule (WidgetKit handles refresh timing).

### Live Activities & Dynamic Island

When a **focus timer is running**, show a Live Activity on the Lock Screen and in the Dynamic Island:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üéØ CS2030 Lab 4  ‚îÇ  18:42  ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë  ‚îÇ  Focus  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

This requires adding a backend endpoint for focus session state sync:

```python
# POST /api/v1/focus/sessions ‚Äî start a session
# PUT /api/v1/focus/sessions/{id} ‚Äî update (pause/resume/complete)
# GET /api/v1/focus/sessions/active ‚Äî get current active session
```

### Shortcuts Integration

Register iOS Shortcuts actions:
- "Start focusing on [task]" ‚Üí starts timer for a task
- "What's due this week?" ‚Üí returns text summary from brief
- "Quick add task: [title]" ‚Üí creates a task

These use the existing API endpoints ‚Äî just need an `IntentDefinition` file in the iOS project.

### Offline Sync Strategy

The iOS app should work **offline** for:
- Viewing timetable (cache in Core Data)
- Viewing tasks and assignments (cache in Core Data)
- Creating new tasks (queue mutations, sync when online)
- Focus timer (runs fully locally, syncs minutes when online)

Use a simple queue: POST/PUT operations are stored locally, then replayed to the backend when connectivity returns. The backend should handle idempotency via `If-Match` headers or `updated_at` timestamps to avoid conflicts.

### Haptic & Sound Design

- **Focus timer complete**: Strong haptic (`.notification`) + custom completion chime
- **Task completed**: Medium haptic (`.impact`) + satisfying check sound
- **Class starting in 5m**: Gentle haptic sequence

---

## Execution Order Recommendation

For **minimum viable improvement**, tackle in this order:

1. **Plan 3** (API key) ‚Äî quick security fix, ~15 min
2. **Plan 1** (Assignments) ‚Äî highest user-impact fix, ~2-3 hours
3. **Plan 2** (Dashboard) ‚Äî second highest impact, ~2 hours
4. **Plan 7** (Design doc) ‚Äî prevents future confusion, ~30 min
5. **Plan 4** (Grades backend) ‚Äî data integrity fix, ~1-2 hours
6. **Plan 5** (Focus integration) ‚Äî quality of life, ~1 hour
7. **Plan 6** (Decompose) ‚Äî maintainability, ~2-3 hours
8. **Plans 8-11** ‚Äî polish features, tackle as time allows

For **iOS app preparation** (do after the above):

9. **Plan 12** (API readiness) ‚Äî JWT auth + pagination, ~2-3 hours
10. **Plan 13** (Push notifications) ‚Äî APNs integration, ~3-4 hours
11. **Plan 14** (iOS features) ‚Äî reference doc for iOS development

